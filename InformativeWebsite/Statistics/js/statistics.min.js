var allData=makeData(readFile()),dict=makeDict(allData);function table(){var t=makeData(readFile());$("#table").dynatable({dataset:{records:t}})}function myFunction(){if(document.getElementById("datepickerFrom").value||document.getElementById("datepickerTo").value){var t=document.getElementById("datepickerFrom").value.split("/"),e=document.getElementById("datepickerTo").value.split("/"),a="".concat(t[2]).concat("-").concat(t[0]).concat("-").concat(t[1]),r="".concat(e[2]).concat("-").concat(e[0]).concat("-").concat(e[1]);t[2]==e[2]&&t[0]==e[0]?t[1]<=e[1]?graph(a,r):alert("Invalid inputs"):t[2]<e[2]?graph(a,r):alert("Invalid inputs")}else graph()}function graph(t,e){am4core.ready(function(){if(am4core.useTheme(am4themes_animated),t&&e)a=makeGraphDataFiltered(t,e,dict);else var a=makeGraphData(dict);var r=am4core.create("chartdiv",am4charts.XYChart);r.hiddenState.properties.opacity=0,r.data=a;var n=r.xAxes.push(new am4charts.CategoryAxis);n.renderer.grid.template.location=0,n.dataFields.category="date",n.renderer.minGridDistance=40,n.fontSize=11;var i=r.yAxes.push(new am4charts.ValueAxis);i.min=0,i.max=getMaxVisits(dict),i.strictMinMax=!0,i.renderer.minGridDistance=30;var c=r.series.push(new am4charts.ColumnSeries);c.dataFields.categoryX="date",c.dataFields.valueY="visits",c.columns.template.tooltipText="{valueY.value}",c.columns.template.tooltipY=0,c.columns.template.strokeOpacity=0,c.columns.template.adapter.add("fill",function(t,e){return r.colors.getIndex(e.dataItem.index)})})}function readFile(){var t,e=new XMLHttpRequest;return e.open("GET","database.txt",!1),e.onreadystatechange=function(){if(4===e.readyState&&(200===e.status||0==e.status)){var a=e.responseText;t=a.split(/\r\n|\n/)}},e.send(null),t}function processLine(t){return t.split("#")}function makeData(t){for(var e=[],a=0;a<t.length;a++){var r=processLine(t[a]);e.push({name:r[0],email:r[1],message:r[2],date:r[3]})}return e}function makeGraphData(t){var e=[];for(var a in t)e.push({date:a,visits:t[a]});return e}function makeGraphDataFiltered(t,e,a){var r=[];for(var n in a)n>=t&&n<=e&&r.push({date:n,visits:a[n]});return r}function getMaxVisits(t){var e=0;for(var a in t)t[a]>e&&(e=t[a]);return e+5}function getTotalVisits(t){var e=0;for(var a in t)e+=t[a];return e}function makeDict(t){for(var e={},a=0;a<t.length;a++)e[t[a].date]?e[t[a].date]+=1:e[t[a].date]=1;return e}$(document).ready(function(){$("#total_visits").text("Total visits: "+getTotalVisits(dict)),graph(),$("#datepickerFrom").datepicker(),$("#datepickerTo").datepicker(),table()});